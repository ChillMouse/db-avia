/*3.6. Для выбранного клиента  предусмотреть  возможность просмотра истории ранее подобранных туров.*/

SELECT *
/*В таблице Orders хранятся заказы, как те, которые оформлены на будущее и пока не завершены, 
так и те, которые были оформлены в прошлом и уже завершились. 
Выбираем те заказы, которые по системной дате считаются, что они из прошлого
Математика: системная дата - дата вылета = число. Если системная дата больше, чем дата вылета - то ответ меньше нуля. 
Отсюда следует, что в условии будет проверка на то, больше или меньше нуля вычисленное значение
*/
FROM 
Orders /*Таблица Orders*/
INNER JOIN Clients ON Orders.id_client = Clients.id /*Таблицу Orders объединяем с таблицей Clients, но строки подставляются по соответствию ключей orders.id = Clients.id*/
INNER JOIN Tours ON Orders.id_tour = Tours.id /*объединяем таблицу Tours с предыдущими таблицами, но строки подставляются по соответствию ключей id_tour = Tours.id*/
WHERE /*Условие, если*/
DATEDIFF( /*Встроенная функция разности двух дат с преобразованием в целочисленный тип, значение исчисляется в минутах*/
MINUTE, /*Задаём, что нужно исчислять разность в минутах*/
CONVERT(date, SYSDATETIME()), /* Конвертация в тип date системной даты и получение системной даты с помощью системной функции, чтобы не учитывать время */
CONVERT(date, Tours.dateOutput) /*Конвертация в тип date даты вылета, которая указана в туре*/
) < 0